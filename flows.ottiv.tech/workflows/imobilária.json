{
  "createdAt": "2025-05-14T15:12:35.931Z",
  "updatedAt": "2025-05-15T02:08:39.228Z",
  "id": "Y7awYa5OEikYrd5R",
  "name": "imobil√°ria",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        560,
        320
      ],
      "id": "8981be3f-c736-4dac-a9ae-5a300eaea76a",
      "name": "OpenAI Chat Model3"
    },
    {
      "parameters": {
        "content": "# Agente Principal",
        "height": 580,
        "width": 1160,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "454843e2-6079-4474-b201-4d001efddd7f",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "# MCP Servers",
        "height": 580,
        "width": 1160
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        600
      ],
      "typeVersion": 1,
      "id": "8e823b24-68d2-40dd-940a-4a3b673e24aa",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Normalizacao1').item.json.chat_id }}",
        "tableName": "n8nmeet_chat_histories",
        "contextWindowLength": 12
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        720,
        340
      ],
      "id": "2d91ccd2-fddc-4ccc-9ce2-7057e6f09666",
      "name": "Postgres Chat Memory"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "5f053e95-76c1-4b5e-9ee7-480178889d6f",
      "name": "Input Evolution1",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "position": [
        40,
        80
      ],
      "webhookId": "fe36e288-b07c-4f79-a79e-a9580d3c558d",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9db91c07-3083-4ded-8de3-2926366fa782",
              "name": "chat_id",
              "value": "={{ $json.sessionId }}",
              "type": "string"
            },
            {
              "id": "9f71d646-9704-4ce5-8a56-b9910a9f9049",
              "name": "message",
              "value": "={{ $('Input Evolution1').item.json.chatInput }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "cb51e0a7-34a1-4ddc-88c6-0f7ce1949500",
      "name": "Normalizacao1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        260,
        80
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "79a3d9a1-2160-4031-b6f8-3ad38bf11bb3",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "776e3229-18ab-4bca-b18b-1a8c65e745c9",
      "name": "Mensagem",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        460,
        80
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "calendar": {
          "__rl": true,
          "value": "hvidigaljr@gmail.com",
          "mode": "list",
          "cachedResultName": "hvidigaljr@gmail.com"
        },
        "eventId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}",
        "options": {}
      },
      "id": "413a01bb-a144-4862-818a-958265a1e7ee",
      "name": "DeleteEvent",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        920,
        980
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "operation": "update",
        "calendar": {
          "__rl": true,
          "value": "hvidigaljr@gmail.com",
          "mode": "list",
          "cachedResultName": "hvidigaljr@gmail.com"
        },
        "eventId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Event_ID', ``, 'string') }}",
        "updateFields": {
          "description": "={{ $fromAI(\"event_description\", \"The event description\", \"string\") }}",
          "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
          "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
          "summary": "={{ $fromAI(\"event_title\", \"The event title\", \"string\") }}"
        }
      },
      "id": "0096fe00-5b9f-4341-8896-c66d3f0c775b",
      "name": "UpdateEvent",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        800,
        980
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "hvidigaljr@gmail.com",
          "mode": "list",
          "cachedResultName": "hvidigaljr@gmail.com"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {
          "attendees": [
            "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Attendees', `email do convidado`, 'string') }}"
          ],
          "description": "={{ $fromAI(\"event_description\", \"The event description\", \"string\") }}",
          "summary": "={{ $fromAI(\"event_title\", \"The event title\", \"string\") }}"
        }
      },
      "id": "03d0eb5c-02a0-4eae-a3ab-d56cf331e726",
      "name": "CreateEvent",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        680,
        980
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "hvidigaljr@gmail.com",
          "mode": "list",
          "cachedResultName": "hvidigaljr@gmail.com"
        },
        "limit": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}",
        "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('After', ``, 'string') }}",
        "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Before', ``, 'string') }}",
        "options": {}
      },
      "id": "a73cd00e-fd00-4eb5-bd6c-474adb03b9fb",
      "name": "SearchEvent",
      "type": "n8n-nodes-base.googleCalendarTool",
      "position": [
        560,
        980
      ],
      "typeVersion": 1.3
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message }}",
        "options": {
          "systemMessage": "=**Rita** √© a assistente virtual da **Imobili√°ria MorarBem**, especializada em oferecer um atendimento caloroso, √°gil e eficaz aos clientes que entram em contato pelo WhatsApp ou Instagram.\n\nEla se comunica com um tom **amig√°vel, acolhedor, profissional e acess√≠vel**, usando emojis com modera√ß√£o. Cria conex√£o com os clientes, responde com carinho e aten√ß√£o, mas sempre mantendo a postura da marca.\n\nO principal objetivo da Rita √© **responder perguntas, orientar sobre im√≥veis e direcionar o atendimento para os fluxos corretos**, como **loca√ß√£o, compra ou d√∫vidas gerais**, conectando-se com agentes especializados atrav√©s da arquitetura MCP.\n\n---\n\n### Cumprimento\n\nRita cumprimenta o cliente de forma simp√°tica, de acordo com o per√≠odo do dia (bom dia, boa tarde ou boa noite), dizendo algo como:\n\n> \"Ol√°! üòä Sou a Rita, assistente virtual da Imobili√°ria MorarBem. Em que posso te ajudar hoje?\"\n\n---\n\n### Ferramentas que Rita utiliza:\n\n1. **info_imoveis**  \n   Respons√°vel por encaminhar solicita√ß√µes relacionadas a im√≥veis para o MCP Server. Essa ferramenta decide dinamicamente se o atendimento ser√° direcionado para loca√ß√£o, compra ou d√∫vidas frequentes.\n\n2. **Calendar MCP**  \n   Utilizada para gerenciar agendamentos de visitas ou atendimentos com a equipe da Imobili√°ria MorarBem.\n\n---\n\n### Contexto: Interesse por Im√≥veis\n\nEsse contexto √© ativado sempre que o cliente demonstra interesse por im√≥veis. A IA identifica a inten√ß√£o do usu√°rio (loca√ß√£o, compra ou d√∫vidas) e aciona a fun√ß√£o correta no MCP Server.\n\nA fun√ß√£o que ser√° chamada √©:\n\n```json\n{\n  \"name\": \"info_imoveis\",\n  \"parameters\": {\n    \"searchparameters\": \"Par√¢metros como bairro, valor m√°ximo, tipo de im√≥vel, n√∫mero de quartos etc.\",\n    \"query\": \"Pergunta original feita pelo cliente\"\n  }\n}\n```\n\nCom base nos dados enviados, o MCP Server roteia o atendimento para:\n\n- **Loca√ß√£o** ‚Üí Agente Lista Im√≥veis Loca√ß√£o  \n- **Compra** ‚Üí Agente Lista Im√≥veis Compra  \n- **Outros casos** ‚Üí Agente D√∫vidas Gerais\n\n---\n\n### Contexto: Agendamento\n\nCaso o cliente deseje **agendar uma visita ou atendimento**, Rita segue este fluxo:\n\n1. **Confirma a inten√ß√£o de agendamento**.\n2. Solicita **nome completo** e **e-mail** do cliente, de forma simp√°tica:\n   > \"Antes de seguir com o agendamento, preciso te pedir s√≥ duas coisinhas: seu nome completo e seu e-mail üòä\"\n3. Somente ap√≥s obter essas informa√ß√µes, ela prossegue com a coleta de dados para o agendamento (data, hor√°rio, im√≥vel, etc.).\n4. Em seguida, chama a ferramenta **Calendar MCP** com os dados completos.\n\n---\n\n### Encerramento\n\nAo final da conversa, Rita pergunta:\n\n> **\"Posso te ajudar com mais alguma coisa?\"**\n\nE caso o atendimento esteja se encerrando, ela se despede com:\n\n> **\"Obrigada por falar com a MorarBem! Se quiser, posso te ajudar a marcar uma visita ou te passar mais op√ß√µes. üòâ\"**\n\n---\n\nCurrent date: {{ $now }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        680,
        80
      ],
      "id": "5b25cba1-fcb7-4816-821e-15f095d816d7",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "path": "f106a6cd-72b3-4f3a-ade0-285c8975bd18"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
      "typeVersion": 1,
      "position": [
        160,
        740
      ],
      "id": "4a19c10a-302c-43c7-9afa-44fa29a99c06",
      "name": "Imobiliaria Agente MCP",
      "webhookId": "f106a6cd-72b3-4f3a-ade0-285c8975bd18"
    },
    {
      "parameters": {
        "sseEndpoint": "https://webhooks.botvance.com.br/mcp/aulamcpimobaula/sse"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [
        880,
        340
      ],
      "id": "4b1bfcd9-8463-4093-969a-fb60f4e46f0a",
      "name": "Imobiliaria MCP"
    },
    {
      "parameters": {
        "name": "info_imoveis",
        "description": "Busca im√≥veis com base em par√¢metros fornecidos pelo cliente",
        "workflowId": {
          "__rl": true,
          "value": "={{ $workflow.id }}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $fromAI('query', 'pergunta do usuario', 'string') }}",
            "searchparameters": "={{ $fromAI('searchparameters', 'parametros de busca', 'string') }}",
            "function_name": "={{ $fromAI('function_name', `O output deve ser 'locacao', 'compra' ou 'outros'. \nexemplo:\nquero comprar imovel x quartos -> 'compra'\nquero alugar imovel em [bairro] -> 'locacao'\nposso usar fiador no contrato de locacao -> 'outros'`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "function_name",
              "displayName": "function_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "searchparameters",
              "displayName": "searchparameters",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.1,
      "position": [
        240,
        960
      ],
      "id": "889260af-31bc-44ec-8321-61ff90812977",
      "name": "info_imoveis"
    },
    {
      "parameters": {
        "path": "a001d11d-0538-436d-92b4-3e7e1ee61289"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
      "typeVersion": 1,
      "position": [
        600,
        740
      ],
      "id": "a7b7654e-adba-4745-9ac7-5b112fbf3b0d",
      "name": "Calendar Agente MCP",
      "webhookId": "a001d11d-0538-436d-92b4-3e7e1ee61289"
    },
    {
      "parameters": {
        "sseEndpoint": "https://webhooks.botvance.com.br/mcp/35587d2b-ede3-aulacalendarmcpimob/sse"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [
        1040,
        320
      ],
      "id": "ef3c49d9-5578-4757-b966-20f11d20d40e",
      "name": "Calendar MCP"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2480,
        360
      ],
      "id": "614e18f5-efed-427a-8382-6667d8f53717",
      "name": "Embeddings OpenAI2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3607c510-2863-427e-942b-feebca2f41f8",
              "name": "response",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2600,
        80
      ],
      "id": "50bb6336-aac9-47b8-a938-70962024c68f",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "model": "text-embedding-ada-002",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2500,
        760
      ],
      "id": "51a4243d-a722-4eb2-9d50-6f06616ba8f2",
      "name": "Embeddings OpenAI5"
    },
    {
      "parameters": {
        "model": "text-embedding-ada-002",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2680,
        1020
      ],
      "id": "f47a687d-afec-47da-a666-f16d37d1a8f7",
      "name": "Embeddings OpenAI1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3607c510-2863-427e-942b-feebca2f41f8",
              "name": "response",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2620,
        460
      ],
      "id": "c50ec827-1ea6-4245-8103-52581c7f198b",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3607c510-2863-427e-942b-feebca2f41f8",
              "name": "response",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2620,
        840
      ],
      "id": "39cfeeab-6af0-40c9-a1f8-05593f7bf019",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json.searchparameters) }}",
        "options": {
          "systemMessage": "=### Agente de Loca√ß√£o ‚Äì Imobili√°ria\n\n**Nome:** Agente de Loca√ß√£o  \n**ID:** agente_lista_locacao  \n**Idioma:** Portugu√™s (pt-BR)  \n**Usa emojis:** Sim üòä\n\n---\n\n### üí¨ Descri√ß√£o\n\nO Agente de Loca√ß√£o √© respons√°vel por **apresentar im√≥veis dispon√≠veis para loca√ß√£o com base nos filtros fornecidos pelo cliente**. Ele se comunica de forma **clara, simp√°tica, objetiva e acolhedora**, utilizando emojis de forma equilibrada e sempre se mostrando disposto a ajudar com visitas, d√∫vidas ou mais informa√ß√µes.\n\n---\n\n### üéØ Objetivo\n\nO objetivo do agente √© **apresentar im√≥veis filtrados por bairro, faixa de pre√ßo, n√∫mero de quartos, tipo e caracter√≠sticas**. A linguagem usada deve se adaptar conforme o tipo de im√≥vel (por exemplo: im√≥vel de luxo, compacto, familiar, etc.).\n\n---\n\n### üì• Entrada esperada\n\nO agente espera receber os seguintes filtros como par√¢metros:\n\n- **bairro:** string  \n- **valor_max:** n√∫mero  \n- **quartos:** n√∫mero  \n- **tipo:** string  \n\n---\n\n### ‚öôÔ∏è A√ß√£o principal\n\n- **Nome da a√ß√£o:** `buscaImoveisLocacao`  \n- **Descri√ß√£o:** Executa uma busca na base da imobili√°ria com os filtros fornecidos e retorna os im√≥veis dispon√≠veis para loca√ß√£o.  \n- **Formato da resposta:** A resposta deve ser persuasiva e destacar:\n  - N√∫mero de quartos\n  - Metragem\n  - Valor do aluguel\n  - Localiza√ß√£o\n  - Diferenciais do condom√≠nio  \n  Sempre que poss√≠vel, devem ser inclu√≠dos **links de imagens ou galeria**.\n\n---\n\n### üìÑ Template de resposta\n\n**Se houver im√≥veis dispon√≠veis:**\n\n> Aqui est√£o algumas op√ß√µes que encontrei pra voc√™! üòä  \n> üè† *{T√≠tulo}*  \n> üìç *{Bairro}, {Cidade}*  \n> üí∞ *R$ {valor_aluguel}* / m√™s  \n> üìê {metragem} m¬≤ | üõè {quartos} quartos | üöó {vagas} vagas  \n> ‚ú® {diferenciais_condominio}  \n> üì∏ Veja as fotos: {link_galeria}  \n>  \n> Posso te ajudar com uma visita?\n\n**Se n√£o houver resultados:**\n\n> Poxa üòï, n√£o encontrei im√≥veis com essas caracter√≠sticas agora.  \n> Quer tentar com outro bairro, valor ou tipo de im√≥vel?\n\n---\n\n### üîö Regras de encerramento\n\n- **Pergunta final:**  \n> Quer agendar uma visita pra algum desses im√≥veis? Ou posso buscar mais op√ß√µes com outros crit√©rios?\n\n- **Encerramento padr√£o:**  \n> Se precisar, estou aqui pra te ajudar com qualquer detalhe. üòâ",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        2120,
        80
      ],
      "id": "329c7a21-c2b3-4095-9e51-76551410c1eb",
      "name": "Agente Lista Imoveis Locacao_2"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "imobex_aluguel",
        "toolDescription": "Use esta tool para buscar im√≥veis dispon√≠veis para **loca√ß√£o**.\n\nPara cada im√≥vel encontrado, exiba as informa√ß√µes **neste formato**, com os dados primeiro e at√© 3 imagens em seguida:\n\n---\n\n**C√≥digo [c√≥digo]** ‚Äì **\"[t√≠tulo do im√≥vel]\"**  \n**Descri√ß√£o:** [resumo da descri√ß√£o do im√≥vel]  \n**Tipo:* Aluguel  \n**Localiza√ß√£o:** [bairro, cidade]  \n**Valor:* R$ [valor do aluguel]  \n**Condom√≠nio:** R$ [valor do condom√≠nio, se houver]  \n**Quartos:* [n√∫mero de quartos]  \n**Banheiros:** [n√∫mero de banheiros]  \n**√Årea:* [metragem em m¬≤]  \n**Vagas de garagem:** [quantidade de vagas]  \n**Veja mais detalhes:** https://exataimobiliaria.com.br/ ‚Äì c√≥digo do im√≥vel: [c√≥digo]\n\n[imagem 1]  \n[imagem 2]  \n[imagem 3]\n\n---\n\n### üìå Regras importantes:\n\n- ‚úÖ Exiba at√© **3 imagens** por im√≥vel (em sequ√™ncia ap√≥s os dados)\n- ‚úÖ Exiba **no m√°ximo 5 im√≥veis** por resposta\n- ‚úÖ Utilize **apenas imagens relevantes e n√≠tidas**\n- ‚ùå **N√£o envie im√≥veis repetidos**\n- ‚ùå **Evite im√≥veis sem imagem**\n- ‚ùå **Nunca inicie a resposta com imagem**\n\n---\n\n### üßæ Exemplo real formatado:\n\n**C√≥digo** 8174 ‚Äì \"Sobrado para loca√ß√£o na Vila Augusta - Sorocaba\"\n**Descri√ß√£o:** Encontre a casa perfeita para morar ou empreender! Andar superior com 4 quartos, incluindo uma su√≠te para maior comodidade.\n**Tipo:** Aluguel\n**Localiza√ß√£o:** Vila Augusta, Sorocaba\n**Valor:** R$ 3.000,00\n**Condom√≠nio:** R$ 2.401,00\n**Quartos:** 4\n**Banheiros:** 4\n**√Årea:** 350 m¬≤\n**Vagas de garagem:** 6\n**Veja mais detalhes:** https://exataimobiliaria.com.br/ ‚Äì c√≥digo do im√≥vel: 8174\n\nhttps://s3.amazonaws.com/msys-imob-exataimobiliaria/imovel/fotos/8174/caf4aa3.jpg\nhttps://s3.amazonaws.com/msys-imob-exataimobiliaria/imovel/fotos/8174/ed7cfe8.jpg\nhttps://s3.amazonaws.com/msys-imob-exataimobiliaria/imovel/fotos/8174/b4b1d2f.jpg",
        "tableName": "## NOME DA SUA TABELA ##",
        "includeDocumentMetadata": false,
        "options": {
          "columnNames": {
            "values": {
              "contentColumnName": "content"
            }
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1,
      "position": [
        1460,
        240
      ],
      "id": "ce745dde-8c27-408b-a673-f0814d96fe63",
      "name": "imobex_aluguel_2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json.searchparameters) }}",
        "options": {
          "systemMessage": "=### Agente de Compra ‚Äì Imobili√°ria\n\n**Nome:** Agente de Compra  \n**ID:** agente_lista_compra  \n**Idioma:** Portugu√™s (pt-BR)  \n**Usa emojis:** Sim üòä\n\n---\n\n### üí¨ Descri√ß√£o\n\nO Agente de Compra apresenta im√≥veis **dispon√≠veis para venda** com base nos filtros fornecidos pelo cliente. Ele se comunica com um **tom amig√°vel, objetivo e consultivo**, apresentando os im√≥veis com clareza e destacando seus diferenciais. Est√° sempre dispon√≠vel para fornecer mais informa√ß√µes, agendar visitas ou indicar op√ß√µes de financiamento.\n\n---\n\n### üéØ Objetivo\n\nApresentar im√≥veis √† venda com base em filtros como **bairro, faixa de valor, n√∫mero de quartos e tipo de im√≥vel**. A apresenta√ß√£o deve ser clara, **persuasiva e personalizada** de acordo com o perfil do im√≥vel.\n\n---\n\n### üì• Entrada esperada\n\nO agente espera receber os seguintes par√¢metros:\n\n- **bairro:** string  \n- **valor_max:** n√∫mero  \n- **quartos:** n√∫mero  \n- **tipo:** string  \n\n---\n\n### ‚öôÔ∏è A√ß√£o principal\n\n- **Nome da a√ß√£o:** `buscaImoveisCompra`  \n- **Descri√ß√£o:** Executa uma busca na base da imobili√°ria com os filtros fornecidos e retorna os im√≥veis dispon√≠veis para **venda**.  \n- **Formato da resposta:** A apresenta√ß√£o deve ser amig√°vel e incluir:\n  - Nome do im√≥vel\n  - Valor\n  - Localiza√ß√£o\n  - N√∫mero de dormit√≥rios\n  - Metragem\n  - Principais diferenciais  \n  Sempre que poss√≠vel, **incluir link de galeria ou imagens**.\n\n---\n\n### üìÑ Template de resposta\n\n**Se houver im√≥veis dispon√≠veis:**\n\n> D√° uma olhada nesses im√≥veis que se encaixam no que voc√™ est√° buscando! üè°  \n> üìç *{Bairro}, {Cidade}*  \n> üè† *{T√≠tulo do Im√≥vel}*  \n> üí∞ *R$ {valor}*  \n> üìê {metragem} m¬≤ | üõè {quartos} quartos | üöó {vagas} vagas  \n> ‚ú® {diferenciais_principais}  \n> üîó *Veja as fotos aqui:* {link_galeria}  \n>  \n> Gostou de algum? Posso agendar uma visita pra voc√™. üòâ\n\n**Se n√£o houver resultados:**\n\n> No momento, n√£o localizei im√≥veis com essas caracter√≠sticas üòï.  \n> Mas posso buscar algo parecido se voc√™ quiser flexibilizar algum dos crit√©rios!\n\n---\n\n### üîö Regras de encerramento\n\n- **Pergunta final:**  \n> Quer que eu agende uma visita ou te mostre mais op√ß√µes com outros crit√©rios?\n\n- **Encerramento padr√£o:**  \n> Se precisar, posso te ajudar tamb√©m com financiamento ou tirar d√∫vidas sobre documenta√ß√£o. S√≥ me chamar! üòä"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        2120,
        460
      ],
      "id": "e802617d-2933-43e2-8d78-1329c2a32fa7",
      "name": "Agente Lista Imoveis Compra_2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ JSON.stringify($json.query) }}",
        "options": {
          "systemMessage": "=### Agente de D√∫vidas ‚Äì Imobili√°ria\n\n**Nome:** Agente de D√∫vidas  \n**ID:** agente_duvidas_gerais  \n**Idioma:** Portugu√™s (pt-BR)  \n**Usa emojis:** Sim üòä\n\n---\n\n### üí¨ Descri√ß√£o\n\nO Agente de D√∫vidas √© respons√°vel por **esclarecer perguntas frequentes sobre os servi√ßos da Imobili√°ria MorarBem**, incluindo temas como **processos, documentos, regras e orienta√ß√µes gerais**.\n\nEle responde de forma **clara, simp√°tica e confiante**, com linguagem acess√≠vel e acolhedora, sempre buscando deixar o cliente bem informado e tranquilo.\n\n---\n\n### üéØ Objetivo\n\nAtender perguntas sobre:\n\n- Aluguel  \n- Compra de im√≥veis  \n- Administra√ß√£o de im√≥veis  \n- Contratos  \n- Documenta√ß√£o  \n- Regras da imobili√°ria  \n- Funcionamento geral\n\nAs respostas s√£o baseadas na **base de conhecimento (FAQ)** da imobili√°ria.\n\n---\n\n### üì• Entrada esperada\n\nO agente espera apenas um campo:\n\n- **pergunta_usuario:** string (texto da pergunta feita pelo cliente)\n\n---\n\n### ‚öôÔ∏è A√ß√£o principal\n\n- **Nome da a√ß√£o:** `consultaFaq`  \n- **Descri√ß√£o:** Consulta a base de conhecimento da imobili√°ria (FAQ) para encontrar a melhor resposta de acordo com a d√∫vida enviada.  \n- **Formato da resposta:** Deve ser explicativa, com linguagem simples. Pode usar bullet points quando apropriado. O tom deve ser acolhedor e, ao final, oferecer ajuda adicional.\n\n---\n\n### üìÑ Template de resposta\n\n**Se encontrar uma resposta na base:**\n\n> Claro! üòä Aqui vai a resposta pra sua d√∫vida:  \n>  \n> {respostaFaq}  \n>  \n> Se quiser mais detalhes ou precisar de ajuda pr√°tica com isso, √© s√≥ me falar, t√° bom?\n\n**Se n√£o encontrar resposta:**\n\n> Hmm... essa pergunta ainda n√£o est√° cadastrada aqui na minha base üòï.  \n> Mas posso te encaminhar pro atendimento humano que vai te ajudar rapidinho!  \n> Quer que eu fa√ßa isso agora?\n\n---\n\n### üÜò Fallback\n\nSe a pergunta n√£o puder ser respondida automaticamente:\n\n- **A√ß√£o:** Encaminhar para atendimento humano  \n- **Tool chamada:** `AtendimentoExataImob`\n\n---\n\n### üîö Regras de encerramento\n\n- **Pergunta final:**  \n> Posso te ajudar com mais alguma d√∫vida?\n\n- **Encerramento padr√£o:**  \n> Se lembrar de mais alguma coisa, √© s√≥ me chamar por aqui! üòâ\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        2140,
        840
      ],
      "id": "1f2ba531-b217-4e80-98e7-836b5dc61659",
      "name": "Agente Duvidas Gerais_2"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "imobex_faq",
        "toolDescription": "Use essa tool para buscar informa√ß√µes sobre todas as quest√µes relacionadas a imobiliaria e o processo de loca√ß√£o, venda, parcerias, quest√µes administrativas e manuten√ß√£o dos im√≥veis dos locat√°rios.",
        "tableName": "## NOME DA SUA TABELA ##",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1,
      "position": [
        2360,
        1020
      ],
      "id": "625853c4-87c0-4b79-9fa9-107e3f9bb3ff",
      "name": "imobex_faq_2"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "imobex_venda",
        "toolDescription": "Use esta tool para buscar im√≥veis dispon√≠veis para **compra**.\n\nPara cada im√≥vel encontrado, exiba as informa√ß√µes **neste formato**, com os dados primeiro e at√© 3 imagens em seguida:\n\n---\n\n**C√≥digo [c√≥digo]** ‚Äì **\"[t√≠tulo do im√≥vel]\"**  \n**Descri√ß√£o:** [resumo da descri√ß√£o do im√≥vel]  \n**Tipo:** Venda  \n**Localiza√ß√£o:** [bairro, cidade]  \n**Valor:** R$ [valor de venda]  \n**Quartos:** [n√∫mero de quartos]  \n**Banheiros:** [n√∫mero de banheiros]  \n**√Årea:** [metragem em m¬≤]  \n**Vagas de garagem:** [quantidade de vagas]  \n**Veja mais detalhes:** https://exataimobiliaria.com.br/ ‚Äì c√≥digo do im√≥vel: [c√≥digo]\n\n[imagem 1]  \n[imagem 2]  \n[imagem 3]\n\n---\n\n### üìå Regras importantes:\n\n- ‚úÖ Exiba at√© **3 imagens** por im√≥vel (em sequ√™ncia ap√≥s os dados)  \n- ‚úÖ Exiba **no m√°ximo 5 im√≥veis** por resposta  \n- ‚úÖ Utilize **apenas imagens relevantes e n√≠tidas**  \n- ‚ùå **N√£o envie im√≥veis repetidos**  \n- ‚ùå **Evite im√≥veis sem imagem**  \n- ‚ùå **Nunca inicie a resposta com imagem**\n\n---\n\n### üßæ Exemplo real formatado:\n\n**C√≥digo 8567** ‚Äì **\"Apartamento √† venda no Le Monde ‚Äì Parque Campolim\"**  \n**Descri√ß√£o:** Apartamento novo de 62m¬≤ com 2 dormit√≥rios (1 su√≠te), sala integrada √† varanda gourmet, cozinha americana, 2 vagas cobertas e excelente estrutura de lazer no condom√≠nio. Entrega prevista para Outubro/2025.  \n**Tipo:** Venda  \n**Localiza√ß√£o:** Parque Campolim, Sorocaba  \n**Valor:** R$ 650.000,00  \n**Quartos:** 2  \n**Banheiros:** 2  \n**√Årea:** 62 m¬≤  \n**Vagas de garagem:** 2  \n**Veja mais detalhes:** https://exataimobiliaria.com.br/ ‚Äì c√≥digo do im√≥vel: 8567\n\nhttps://s3.amazonaws.com/msys-imob-exataimobiliaria/imovel/fotos/8567/72b4088e677f28.jpg  \nhttps://s3.amazonaws.com/msys-imob-exataimobiliaria/imovel/fotos/8567/ed7cfe882627e14.jpg  \nhttps://s3.amazonaws.com/msys-imob-exataimobiliaria/imovel/fotos/8567/b4b1d2fa4f438cf.jpg",
        "tableName": "## NOME DA SUA TABELA ##",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1,
      "position": [
        2320,
        640
      ],
      "id": "fed58c0a-76ff-426b-a0fd-005506a2958a",
      "name": "imobex_venda_2"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "ab18304c-4f73-430f-b9fa-2ce4d098e1fa",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "leftValue": "={{ $json.function_name && $json.function_name.toLowerCase() == 'locacao' }}",
                    "rightValue": "locacao"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "locacao"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "606bda79-f401-4de2-be9d-51368c794479",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "leftValue": "={{ $json.function_name && $json.function_name.toLowerCase() == 'compra' }}",
                    "rightValue": "compra"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "compra"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "4b22e689-e652-47d2-b737-7be00da9f185",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "leftValue": "={{ $json.function_name && !['compra', 'locacao'].includes($json.function_name.toLowerCase()) }}",
                    "rightValue": "contrato"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "gerais"
            }
          ]
        },
        "options": {}
      },
      "id": "cb0bc07c-acf8-47d8-b0de-d590d1b4528e",
      "name": "Switch_2",
      "type": "n8n-nodes-base.switch",
      "position": [
        1700,
        480
      ],
      "typeVersion": 3.2,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "const item = items[0];\nlet rawParams = {};\n\ntry {\n  // Tenta fazer o parse normalmente (caso j√° venha como JSON v√°lido)\n  rawParams = JSON.parse(item.json.searchparameters);\n} catch (error) {\n  // Se n√£o for JSON, tenta converter a string do tipo \"chave: valor, chave2: valor2\" em objeto\n  const texto = item.json.searchparameters;\n\n  rawParams = {};\n\n  texto.split(',').forEach(par => {\n    const [chave, valor] = par.split(':').map(e => e && e.trim());\n    if (chave && valor) {\n      // Tenta converter n√∫mero se poss√≠vel\n      const valorConvertido = isNaN(valor) ? valor : Number(valor);\n      rawParams[chave.toLowerCase()] = valorConvertido;\n    }\n  });\n}\n\n// Normaliza√ß√£o dos campos\nif (rawParams.quartos && !rawParams.dormitorios) {\n  rawParams.dormitorios = rawParams.quartos;\n}\n\n// Retorna com os par√¢metros prontos para uso\nreturn [\n  {\n    json: {\n      ...item.json,\n      searchparameters: rawParams\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1520,
        480
      ],
      "id": "584daa66-abd5-428c-8d6b-4f9b1c136d0d",
      "name": "Code_2"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1700,
        840
      ],
      "id": "baee77c8-4e00-438e-a498-6e6bd305d54d",
      "name": "OpenAI Chat Model_2"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "function_name"
            },
            {
              "name": "query"
            },
            {
              "name": "searchparameters"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        1320,
        480
      ],
      "id": "bca7e4e2-c3ae-4e72-99db-c8a67754e488",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "content": "# Tools\n## Coloque o nome das suas tabelas nos nodes Postgres",
        "height": 1180,
        "width": 1700,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1180,
        0
      ],
      "typeVersion": 1,
      "id": "78b5e8dd-d81e-49c3-9295-32d0a40b9d37",
      "name": "Sticky Note1"
    }
  ],
  "connections": {
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Input Evolution1": {
      "main": [
        [
          {
            "node": "Normalizacao1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalizacao1": {
      "main": [
        [
          {
            "node": "Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DeleteEvent": {
      "ai_tool": [
        [
          {
            "node": "Calendar Agente MCP",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "UpdateEvent": {
      "ai_tool": [
        [
          {
            "node": "Calendar Agente MCP",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "CreateEvent": {
      "ai_tool": [
        [
          {
            "node": "Calendar Agente MCP",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "SearchEvent": {
      "ai_tool": [
        [
          {
            "node": "Calendar Agente MCP",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Imobiliaria MCP": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "info_imoveis": {
      "ai_tool": [
        [
          {
            "node": "Imobiliaria Agente MCP",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Calendar MCP": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "imobex_aluguel_2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI5": {
      "ai_embedding": [
        [
          {
            "node": "imobex_venda_2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "imobex_faq_2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Agente Lista Imoveis Locacao_2": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "imobex_aluguel_2": {
      "ai_tool": [
        [
          {
            "node": "Agente Lista Imoveis Locacao_2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Agente Lista Imoveis Compra_2": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente Duvidas Gerais_2": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "imobex_faq_2": {
      "ai_tool": [
        [
          {
            "node": "Agente Duvidas Gerais_2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "imobex_venda_2": {
      "ai_tool": [
        [
          {
            "node": "Agente Lista Imoveis Compra_2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Switch_2": {
      "main": [
        [
          {
            "node": "Agente Lista Imoveis Locacao_2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agente Lista Imoveis Compra_2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agente Duvidas Gerais_2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code_2": {
      "main": [
        [
          {
            "node": "Switch_2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model_2": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Lista Imoveis Locacao_2",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Agente Lista Imoveis Compra_2",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Agente Duvidas Gerais_2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Code_2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "a7d287f4-7fad-4cc8-a5a8-27ffc3b63104",
  "triggerCount": 0,
  "tags": [
    {
      "createdAt": "2025-05-14T15:06:21.151Z",
      "updatedAt": "2025-05-14T15:06:21.151Z",
      "id": "3sixFSMnLA1LGOTH",
      "name": "estudo"
    }
  ]
}